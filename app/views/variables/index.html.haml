%h1 Variablen
= link_to 'Neue Variable', new_variable_path
%div
  :javascript
    addLoadEvent(function () {
        $('#tag_field_all').tagsManager({
            prefilled: #{raw @sets},
            deleteTagsOnBackspace: false,
            tagClass: 'tm-tag-small'
        });
        $('#tag_field_all').autocomplete({
            source:#{raw Variable.all.distinct(:variable_sets)}
        });
    });
  = form_tag variables_path(), :method => 'get' do |f|
    %input#tag_field_all.tm-tag{name: "sets", placeholder: "Sets", style: "width:5em;", type: "text"}
    = submit_tag(t('show_selected_sets'), :class => 'tm-tag', :style => 'margin-top: 0px; padding: 3px;')
= form_tag(variables_path, :method => "get") do
  = label_tag(:q, t('search'))
  = text_field_tag(:q, params[:q])
  = submit_tag(t('search'))
%table
  %tr
    %th= t('name')
    %th= t('description')
    %th Type
    %th{width: "300px"} Sets
    %th{width: "80px"}
  - @variables.each do |variable|
    %tr
      %td
        %b
          = variable.field_name
          \:
          %br
          = variable.localized_field('name', locale)
      %td= variable.localized_field('description', locale)
      %td= variable.variable_type
      %td
        :javascript
          addLoadEvent(function () {
              $('#tag_field_#{variable.field_name}').tagsManager({
                  prefilled: #{raw (variable.variable_sets)},
                  deleteTagsOnBackspace: false,
                  tagClass: 'tm-tag-mini'
              });
              $('#tag_field_#{variable.field_name}').autocomplete({
                  source:#{raw Variable.all.distinct(:variable_sets)}
              });
          });
        = form_for variable, :url => set_variable_sets_variable_path(variable), :method => 'post' do |f|
          %input.tm-tag{id: "tag_field_#{variable.field_name}", name: "sets", placeholder: "Sets", style: "width:5em;", type: "text"}
          = submit_tag(t('save'), :class => 'tm-tag', :style => 'margin-top: 0px; padding: 3px;')
      %td
        = link_to image_tag('icons/application_view_list.png', :style => 'border-style:none'), variable
        = link_to image_tag('icons/note_edit.png', :style => 'border-style:none'), edit_variable_path(variable)
        = link_to image_tag('icons/note_delete.png', :style => 'border-style:none'), variable, method: :delete, :title => t('delete_analysis'), :data => {:confirm => t('confirm_delete_analysis')}
